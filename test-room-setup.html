<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Setup Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #0d1b2a;
            color: white;
        }
        .test-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        button {
            background: #ff8c00;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        input {
            padding: 10px;
            margin: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background: rgba(255,255,255,0.05);
        }
    </style>
</head>
<body>
    <h1>üèè IPL Auction Room Setup Test</h1>
    
    <div class="test-section">
        <h2>Server Connection</h2>
        <div id="serverStatus" class="status">Connecting...</div>
        <button onclick="testConnection()">Test Connection</button>
    </div>

    <div class="test-section">
        <h2>Room Management</h2>
        <button onclick="createTestRoom()">Create Room</button>
        <input type="text" id="testRoomId" placeholder="Room ID">
        <button onclick="joinTestRoom()">Join Room</button>
        <div id="roomStatus" class="status">No room connected</div>
    </div>

    <div class="test-section">
        <h2>Team Selection Test</h2>
        <select id="teamSelect">
            <option value="">Select Team</option>
            <option value="Chennai Super Kings">Chennai Super Kings</option>
            <option value="Mumbai Indians">Mumbai Indians</option>
            <option value="Royal Challengers Bengaluru">Royal Challengers Bengaluru</option>
            <option value="Delhi Capitals">Delhi Capitals</option>
            <option value="Kolkata Knight Riders">Kolkata Knight Riders</option>
        </select>
        <button onclick="selectTestTeam()">Select Team</button>
        <div id="teamStatus" class="status">No team selected</div>
    </div>

    <div class="test-section">
        <h2>Auction Test</h2>
        <button onclick="startTestAuction()">Start Auction</button>
        <button onclick="placeBid()">Place Test Bid (‚Çπ5 Cr)</button>
        <div id="auctionStatus" class="status">Auction not started</div>
    </div>

    <div class="test-section">
        <h2>Room Info</h2>
        <button onclick="getRoomInfo()">Get Room Info</button>
        <div id="roomInfo" class="status">Click to get room information</div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket = null;
        let currentRoomId = null;

        function testConnection() {
            socket = io();
            
            socket.on('connect', () => {
                document.getElementById('serverStatus').innerHTML = '‚úÖ Connected: ' + socket.id;
                document.getElementById('serverStatus').style.background = 'rgba(76, 175, 80, 0.2)';
                console.log('Socket connected:', socket.id);
            });

            socket.on('disconnect', () => {
                document.getElementById('serverStatus').innerHTML = '‚ùå Disconnected';
                document.getElementById('serverStatus').style.background = 'rgba(244, 67, 54, 0.2)';
            });

            socket.on('roomCreated', (data) => {
                console.log('Room created:', data);
                currentRoomId = data.roomId;
                document.getElementById('testRoomId').value = data.roomId;
                document.getElementById('roomStatus').innerHTML = `‚úÖ Room Created: ${data.roomId}`;
                document.getElementById('roomStatus').style.background = 'rgba(76, 175, 80, 0.2)';
            });

            socket.on('roomError', (error) => {
                console.error('Room error:', error);
                document.getElementById('roomStatus').innerHTML = `‚ùå Room Error: ${error.message}`;
                document.getElementById('roomStatus').style.background = 'rgba(244, 67, 54, 0.2)';
            });

            socket.on('joinedRoom', (data) => {
                currentRoomId = data.roomId;
                document.getElementById('roomStatus').innerHTML = `‚úÖ Joined: ${data.roomId} (${data.players.length} players)`;
                document.getElementById('roomStatus').style.background = 'rgba(76, 175, 80, 0.2)';
            });

            socket.on('joinError', (error) => {
                document.getElementById('roomStatus').innerHTML = `‚ùå Error: ${error}`;
                document.getElementById('roomStatus').style.background = 'rgba(244, 67, 54, 0.2)';
            });

            socket.on('teamSelected', (data) => {
                document.getElementById('teamStatus').innerHTML = `Team: ${data.teamName}`;
            });

            socket.on('auctionStarted', (data) => {
                document.getElementById('auctionStatus').innerHTML = `‚úÖ Auction Started (${data.teams.length} teams)`;
                document.getElementById('auctionStatus').style.background = 'rgba(76, 175, 80, 0.2)';
            });

            socket.on('bidPlaced', (data) => {
                document.getElementById('auctionStatus').innerHTML = `üí∞ Bid: ‚Çπ${data.bidAmount} Cr by ${data.playerName}`;
            });
        }

        function createTestRoom() {
            if (!socket?.connected) {
                alert('Connect to server first!');
                return;
            }
            
            console.log('Creating test room...');
            document.getElementById('roomStatus').innerHTML = 'Creating room...';
            
            const userData = { 
                name: 'Test Player', 
                email: 'test@test.com', 
                uid: 'test123' 
            };
            
            console.log('Sending createRoom with data:', userData);
            socket.emit('createRoom', userData);
        }

        function joinTestRoom() {
            if (!socket?.connected) return alert('Connect first!');
            const roomId = document.getElementById('testRoomId').value.trim();
            if (!roomId) return alert('Enter Room ID!');
            socket.emit('joinRoom', { roomId, userData: { name: 'Test Player 2', email: 'test2@test.com', uid: 'test456' } });
        }

        function selectTestTeam() {
            if (!socket?.connected || !currentRoomId) return alert('Connect and join room first!');
            const teamName = document.getElementById('teamSelect').value;
            if (!teamName) return alert('Select team first!');
            socket.emit('selectTeam', {
                roomId: currentRoomId,
                teamName,
                playerInfo: { friendName: 'Test Friend', socketId: socket.id, index: 0 }
            });
        }

        function startTestAuction() {
            if (!socket?.connected || !currentRoomId) return alert('Connect and join room first!');
            socket.emit('startAuction', {
                roomId: currentRoomId,
                teams: [
                    { teamName: 'Chennai Super Kings', budget: 10000, players: [] },
                    { teamName: 'Mumbai Indians', budget: 10000, players: [] }
                ]
            });
        }

        function placeBid() {
            if (!socket?.connected || !currentRoomId) return alert('Connect and join room first!');
            socket.emit('placeBid', {
                roomId: currentRoomId,
                bidAmount: 5,
                teamIndex: 0,
                playerName: 'Test Player',
                socketId: socket.id
            });
        }

        function getRoomInfo() {
            fetch('/api/rooms')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('roomInfo').innerHTML = 
                        `Active Rooms: ${data.total}<br>` +
                        data.rooms.map(room => `Room ${room.id}: ${room.players} players`).join('<br>');
                })
                .catch(() => {
                    document.getElementById('roomInfo').innerHTML = 'Error fetching room info';
                });
        }

        window.onload = () => setTimeout(testConnection, 1000);
    </script>
</body>
</html>